<UserControl x:Class="ZenPlatform.MVVM.UserControls.SessionPageControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="Transparent">
    <Border Padding="6" Background="{StaticResource BrushSurface}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="160" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="140" />
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0" Margin="4,0,8,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Grid Grid.Row="0" Margin="0,0,0,8">
                    <Button Content="{Binding BacktestButtonText}"
                            HorizontalAlignment="Stretch"
                            IsEnabled="{Binding IsBacktestButtonEnabled}"
                            Click="OnHistoryBacktestClick" />
                </Grid>

                <Grid Grid.Row="1" VerticalAlignment="Bottom">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="目前部位" Margin="0,2,5,2" VerticalAlignment="Center" />
                    <TextBlock Grid.Row="0" Grid.Column="1"
                               Text="{Binding ElementName=SessionGrid, Path=SelectedItem.PositionText, TargetNullValue=多單 1 口, FallbackValue=多單 1 口}"
                               VerticalAlignment="Center" />

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="浮動損益" Margin="0,2,5,2" VerticalAlignment="Center" />
                    <TextBlock Grid.Row="1" Grid.Column="1"
                               Text="{Binding ElementName=SessionGrid, Path=SelectedItem.FloatProfit, StringFormat={}{0:F1}, TargetNullValue=235.0, FallbackValue=235.0}"
                               VerticalAlignment="Center" />

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="平倉損益" Margin="0,2,5,2" VerticalAlignment="Center" />
                    <TextBlock Grid.Row="2" Grid.Column="1"
                               Text="{Binding ElementName=SessionGrid, Path=SelectedItem.RealizedProfit, StringFormat={}{0:F1}, TargetNullValue=-50.0, FallbackValue=-50.0}"
                               VerticalAlignment="Center" />

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="交易次數" Margin="0,2,5,2" VerticalAlignment="Center" />
                    <TextBlock Grid.Row="3" Grid.Column="1"
                               Text="{Binding ElementName=SessionGrid, Path=SelectedItem.TradeCount, TargetNullValue=3, FallbackValue=3}"
                               VerticalAlignment="Center" />

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="總損益" Margin="0,2,5,2" VerticalAlignment="Center" />
                    <TextBlock Grid.Row="4" Grid.Column="1"
                               Text="{Binding ElementName=SessionGrid, Path=SelectedItem.TotalProfit, StringFormat={}{0:F1}, TargetNullValue=185.0, FallbackValue=185.0}"
                               VerticalAlignment="Center" />
                </Grid>
            </Grid>

            <DataGrid x:Name="SessionGrid" Grid.Column="1"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      HeadersVisibility="Column"
                      ItemsSource="{Binding Sessions}"
                      Background="{StaticResource BrushInputBackground}"
                      Foreground="{StaticResource BrushText}"
                      BorderBrush="{StaticResource BrushBorder}"
                      BorderThickness="1"
                      GridLinesVisibility="Horizontal"
                      RowBackground="#FF1F1F1F"
                      AlternatingRowBackground="#FF232323">
                <DataGrid.Resources>
                    <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="{StaticResource ColorInputBorder}" />
                    <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="{StaticResource ColorText}" />
                    <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}" Color="{StaticResource ColorInputBorder}" />
                    <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightTextBrushKey}" Color="{StaticResource ColorText}" />
                </DataGrid.Resources>
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#FF2A2A2A" />
                        <Setter Property="Foreground" Value="{StaticResource BrushText}" />
                        <Setter Property="BorderBrush" Value="{StaticResource BrushBorder}" />
                        <Setter Property="BorderThickness" Value="0,0,1,1" />
                        <Setter Property="HorizontalContentAlignment" Value="Center" />
                        <Setter Property="VerticalContentAlignment" Value="Center" />
                    </Style>
                </DataGrid.ColumnHeaderStyle>
                <DataGrid.CellStyle>
                    <Style TargetType="{x:Type DataGridCell}">
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="Foreground" Value="{StaticResource BrushText}" />
                        <Setter Property="HorizontalContentAlignment" Value="Center" />
                        <Setter Property="VerticalContentAlignment" Value="Center" />
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="{StaticResource BrushInputBorder}" />
                                <Setter Property="Foreground" Value="{StaticResource BrushText}" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.CellStyle>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="編號" Binding="{Binding Id}" Width="57.43">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Setter Property="TextAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTemplateColumn Header="開始時間" Width="151.76">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" TextAlignment="Center">
                                    <TextBlock.Text>
                                        <MultiBinding Converter="{StaticResource StartTimeDisplayConverter}">
                                            <Binding Path="StartTime" />
                                            <Binding Path="StartPosition" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="狀態" Width="58.76">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" TextAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="{x:Type TextBlock}">
                                            <Setter Property="Text" Value="進行中" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsFinished}" Value="True">
                                                    <Setter Property="Text" Value="結束" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="目前部位"
                                        Binding="{Binding Position, Converter={StaticResource PositionDisplayConverter}}"
                                        Width="86.76">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Setter Property="TextAlignment" Value="Center" />
                                <Setter Property="Foreground"
                                        Value="{Binding Position, Converter={StaticResource PositionBrushConverter}}" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="平均成本" Binding="{Binding AvgEntryPrice, StringFormat={}{0:F1}}" Width="85.76">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Setter Property="TextAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="浮動損益" Binding="{Binding FloatProfit, StringFormat={}{0:F1}}" Width="97.76">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Setter Property="TextAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="已平倉損益" Binding="{Binding RealizedProfit, StringFormat={}{0:F1}}" Width="96.6">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Setter Property="TextAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="交易次數" Binding="{Binding TradeCount}" Width="74">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Setter Property="TextAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
                <DataGrid.RowStyle>
                    <Style TargetType="{x:Type DataGridRow}">
                        <Setter Property="Background" Value="#FF1F1F1F" />
                        <Setter Property="Foreground" Value="{StaticResource BrushText}" />
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="{StaticResource BrushInputBorder}" />
                                <Setter Property="Foreground" Value="{StaticResource BrushText}" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>
            </DataGrid>

            <Grid Grid.Column="2" Margin="10,0,0,0"
                  IsEnabled="{Binding IsBacktestActive, Converter={StaticResource InverseBooleanConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Vertical" VerticalAlignment="Top" HorizontalAlignment="Stretch">
                    <Button Content="策略設定" Margin="0,0,0,6" HorizontalAlignment="Stretch"
                            Click="OnStrategySettingsClick" />
                    <Button Content="保證金查詢" Margin="0,0,0,6" HorizontalAlignment="Stretch"
                            IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.IsBrokerLoginSuccess}"
                            Command="{Binding QueryMarginCommand}" />
                    <Button Content="檢查憑證" Margin="0,0,0,6" HorizontalAlignment="Stretch"
                            IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.IsBrokerLoginSuccess}"
                            Command="{Binding CheckCertCommand}" />
                    <Separator Margin="0,6,0,12" Background="{StaticResource BrushSeparator}" />
                    <Button Content="建立新任務" Margin="0,0,0,6" HorizontalAlignment="Stretch"
                            IsEnabled="{Binding IsStrategyRunning}"
                            Click="OnCreateSessionClick" />
                    <Button Content="全部平倉" Margin="0,0,0,12" HorizontalAlignment="Stretch"
                            IsEnabled="{Binding IsStrategyRunning}" />
                </StackPanel>

                <StackPanel Grid.Row="2" Orientation="Vertical" VerticalAlignment="Bottom" HorizontalAlignment="Stretch">
                    <RadioButton Content="真實交易"
                                 Margin="0,0,0,6"
                                 HorizontalAlignment="Center"
                                 GroupName="{Binding Index}"
                                 IsChecked="{Binding IsRealTrade, Mode=TwoWay}"
                                 IsEnabled="{Binding IsStrategyRunning}"
                                 Checked="OnRealTradeChecked">
                        <RadioButton.Style>
                            <Style TargetType="RadioButton" BasedOn="{StaticResource {x:Type RadioButton}}">
                                <Setter Property="Foreground" Value="{StaticResource BrushText}" />
                                <Style.Triggers>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Foreground" Value="#FF2B2B2B" />
                                        <Setter Property="Opacity" Value="0.5" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </RadioButton.Style>
                    </RadioButton>
                    <RadioButton Content="模擬交易"
                                 Margin="0,0,0,10"
                                 HorizontalAlignment="Center"
                                 GroupName="{Binding Index}"
                                 IsChecked="{Binding IsRealTrade, Converter={StaticResource InverseBooleanConverter}, Mode=TwoWay}"
                                 IsEnabled="{Binding IsStrategyRunning}"
                                 Checked="OnSimTradeChecked">
                        <RadioButton.Style>
                            <Style TargetType="RadioButton" BasedOn="{StaticResource {x:Type RadioButton}}">
                                <Setter Property="Foreground" Value="{StaticResource BrushText}" />
                                <Style.Triggers>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Foreground" Value="#FF2B2B2B" />
                                        <Setter Property="Opacity" Value="0.5" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </RadioButton.Style>
                    </RadioButton>
                    <Button Content="{Binding StrategyButtonText}" Click="OnStrategyToggleClick" HorizontalAlignment="Stretch" />
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</UserControl>

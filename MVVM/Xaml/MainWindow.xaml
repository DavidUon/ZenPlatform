<Window x:Class="ZenPlatform.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ZenPlatform"
        xmlns:uc="clr-namespace:ZenPlatform.MVVM.UserControls"
        xmlns:charts="clr-namespace:Charts;assembly=Charts"
        mc:Ignorable="d"
        Height="450" Width="800"
        Background="{StaticResource BrushWindowBackground}"
        Foreground="{StaticResource BrushText}">
    <Window.Title>
        <MultiBinding StringFormat="{}{0} {1} {2}{3}">
            <Binding Path="ProgramName" />
            <Binding Path="Version1" />
            <Binding Path="Version2" />
            <Binding Path="IsProgramStopped" Converter="{StaticResource StopFlagToTitleSuffixConverter}" />
        </MultiBinding>
    </Window.Title>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="LeftPanelColumn" Width="*" MinWidth="240" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition x:Name="RightPanelColumn" Width="280" MinWidth="160" />
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition x:Name="ChartRow" Height="*" MinHeight="180" />
                    <RowDefinition Height="5" />
                    <RowDefinition x:Name="TaskListRow" Height="220" MinHeight="120" />
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Margin="6" Padding="6" Background="Transparent">
                    <Border.ContextMenu>
                        <ContextMenu Opened="ChartContextMenu_Opened">
                            <MenuItem Header="技術指標" Click="OnChartIndicatorClick" />
                            <Separator />
                            <MenuItem x:Name="ChartMenuCrosshair" Header="顯示十字座標" IsCheckable="True" Click="OnChartCrosshairToggle" />
                            <MenuItem x:Name="ChartMenuTooltip" Header="顯示查價視窗" IsCheckable="True" Click="OnChartTooltipToggle" />
                            <Separator />
                            <MenuItem Header="匯入歷史" Click="OnImportHistoryClick" />
                        </ContextMenu>
                    </Border.ContextMenu>
                    <charts:MultiPaneChartView x:Name="MainChartView" />
                </Border>

                <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                              ResizeDirection="Rows" />

                <Border Grid.Row="2" Margin="6" Padding="6">
                    <TabControl x:Name="SessionTabs"
                                ItemsSource="{Binding SessionPages}"
                                SelectionChanged="OnSessionTabChanged">
                        <TabControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding DisplayName}"
                                           Foreground="{Binding RelativeSource={RelativeSource AncestorType=TabItem}, Path=Foreground}" />
                            </DataTemplate>
                        </TabControl.ItemTemplate>
                        <TabControl.ItemContainerStyle>
                            <Style TargetType="{x:Type TabItem}" BasedOn="{StaticResource {x:Type TabItem}}">
                                <Setter Property="Foreground" Value="{StaticResource BrushText}" />
                                <Style.Triggers>
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition Binding="{Binding IsBacktestActive}" Value="False" />
                                            <Condition Binding="{Binding IsStrategyRunning}" Value="True" />
                                            <Condition Binding="{Binding IsRealTrade}" Value="True" />
                                        </MultiDataTrigger.Conditions>
                                        <Setter Property="Foreground" Value="{StaticResource BrushTabRealTrade}" />
                                    </MultiDataTrigger>
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition Binding="{Binding IsBacktestActive}" Value="False" />
                                            <Condition Binding="{Binding IsStrategyRunning}" Value="True" />
                                            <Condition Binding="{Binding IsRealTrade}" Value="False" />
                                        </MultiDataTrigger.Conditions>
                                        <Setter Property="Foreground" Value="{StaticResource BrushMarketOpen}" />
                                    </MultiDataTrigger>
                                    <DataTrigger Binding="{Binding IsBacktestActive}" Value="True">
                                        <Setter Property="Foreground" Value="#FFFFFF" />
                                        <Setter Property="Background" Value="{StaticResource BrushTabBacktest}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TabControl.ItemContainerStyle>
                        <TabControl.ContentTemplate>
                            <DataTemplate>
                                <uc:SessionPageControl />
                            </DataTemplate>
                        </TabControl.ContentTemplate>
                    </TabControl>
                </Border>
            </Grid>

            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                          ResizeDirection="Columns" />

            <Grid Grid.Column="2" Margin="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="40" />
                    <RowDefinition x:Name="LogHeaderStatusRow" Height="0" />
                    <RowDefinition Height="5" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Border x:Name="LogHeaderBorder" Grid.Row="0" Padding="1">
                    <Grid>
                        <TextBlock x:Name="LogHeaderText"
                                   Text="台指二號"
                                   TextWrapping="Wrap"
                                   FontSize="25"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   TextAlignment="Center"
                                   Cursor="Hand"
                                   MouseLeftButtonUp="OnLogHeaderClick" />
                        <TextBlock x:Name="LogHeaderSubText"
                                   Text=""
                                   FontSize="12"
                                   Foreground="{StaticResource BrushText}"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Bottom"
                                   Margin="0,0,0,4"
                                   TextAlignment="Center"
                                   IsHitTestVisible="False" />
                        <TextBox x:Name="LogHeaderEditBox"
                                 Visibility="Collapsed"
                                 FontSize="25"
                                 HorizontalAlignment="Center"
                                 VerticalAlignment="Center"
                                 TextAlignment="Center"
                                 Background="{StaticResource BrushInputBackground}"
                                 Foreground="{StaticResource BrushText}"
                                 BorderBrush="{StaticResource BrushInputBorder}"
                                 BorderThickness="1"
                                 Padding="6,2"
                                 LostFocus="OnLogHeaderEditLostFocus"
                                 KeyDown="OnLogHeaderEditKeyDown" />
                    </Grid>
                </Border>

                <Border x:Name="LogHeaderStatusBorder" Grid.Row="1" Padding="4" Background="{StaticResource BrushTabBacktest}" Visibility="Collapsed">
                    <Grid>
                        <ProgressBar x:Name="LogHeaderProgressBar"
                                     Height="10"
                                     Minimum="0"
                                     Maximum="100"
                                     Value="0"
                                     VerticalAlignment="Center"
                                     Foreground="#FFD46A00"
                                     Background="#FF1B1B1B"
                                     BorderThickness="0"/>
                        <TextBlock x:Name="LogHeaderStatusText"
                                   Text=""
                                   Foreground="#FFFFFF"
                                   FontSize="15"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   TextAlignment="Center"
                                   Visibility="Collapsed" />
                    </Grid>
                </Border>

                <GridSplitter Grid.Row="2" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                              ResizeDirection="Rows" />

                <Border Grid.Row="3" Padding="1">
                    <RichTextBox x:Name="LogOutputBox"
                                 Background="{StaticResource BrushInputBackground}"
                                 Foreground="{StaticResource BrushText}"
                                 BorderBrush="{StaticResource BrushBorder}"
                                 BorderThickness="1"
                                 Style="{StaticResource LogRichTextBoxStyle}"
                                 HorizontalScrollBarVisibility="Disabled"
                                 VerticalScrollBarVisibility="Auto" />
                </Border>
            </Grid>
        </Grid>

        <StatusBar Grid.Row="1" Height="24">
            <StatusBarItem HorizontalContentAlignment="Stretch">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="800" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="800" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock x:Name="MagistockStatusText" Text="Magistock" Foreground="{StaticResource BrushStatusClosed}" Margin="6,0,0,0" />
                        <TextBlock Text=" " />
                        <TextBlock x:Name="UserStatusText" Text="使用者" Margin="10,0,0,0" Cursor="Hand" Padding="4,0"
                                   ToolTipService.InitialShowDelay="0"
                                   ToolTipService.BetweenShowDelay="0"
                                   ToolTipService.Placement="Top"
                                   MouseLeftButtonUp="OnUserLoginClick">
                            <TextBlock.Style>
                                <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Background" Value="Transparent" />
                                    <Setter Property="Foreground" Value="{StaticResource BrushStatusClosed}" />
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ClientCtrl.IsRealUserLogin}" Value="True">
                                            <Setter Property="Foreground" Value="{StaticResource BrushMarketOpen}" />
                                        </DataTrigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#FF787878" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <TextBlock Text=" " />
                        <TextBlock x:Name="BrokerStatusText" Text="期貨商連線" Margin="10,0,0,0"
                                   ToolTipService.InitialShowDelay="0"
                                   ToolTipService.BetweenShowDelay="0"
                                   ToolTipService.Placement="Top">
                            <TextBlock.Style>
                                <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Foreground" Value="{StaticResource BrushStatusClosed}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsBrokerConnected}" Value="True">
                                            <Setter Property="Foreground" Value="{StaticResource BrushMarketOpen}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <TextBlock Text=" " />
                        <TextBlock x:Name="DdePriceStatusText" Text="DDE報價" Margin="10,0,0,0" />
                        <TextBlock Text=" " />
                        <TextBlock x:Name="NetPriceStatusText" Text="網路報價" Margin="10,0,0,0" />
                    </StackPanel>

                    <Grid Grid.Column="1" />

                    <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock Text="聯絡客服" Cursor="Hand" Padding="4,0"
                               MouseLeftButtonUp="OnSupportClick">
                        <TextBlock.Style>
                            <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource {x:Type TextBlock}}">
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#FF787878" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <Border Width="1" Margin="8,2" Background="{StaticResource BrushBorder}" />
                    <TextBlock Text="管理歷史資料" Cursor="Hand" Padding="4,0"
                               MouseLeftButtonUp="OnManageHistoryClick">
                        <TextBlock.Style>
                            <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource {x:Type TextBlock}}">
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#FF787878" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <Border Width="1" Margin="8,2" Background="{StaticResource BrushBorder}" />
                    <TextBlock Text="休假排程" Cursor="Hand" Padding="4,0"
                               MouseLeftButtonUp="OnHolidayScheduleClick">
                        <TextBlock.Style>
                            <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource {x:Type TextBlock}}">
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#FF787878" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <Border Width="1" Margin="8,2" Background="{StaticResource BrushBorder}" />
                    <TextBlock x:Name="MarketStatusText">
                        <TextBlock.Style>
                            <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource {x:Type TextBlock}}">
                                <Setter Property="Text" Value="收盤中" />
                                <Setter Property="Foreground" Value="{StaticResource BrushMarketClosed}" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsMarketOpen}" Value="True">
                                        <Setter Property="Text" Value="開盤中" />
                                        <Setter Property="Foreground" Value="{StaticResource BrushMarketOpen}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                        <Border Width="1" Margin="8,2" Background="{StaticResource BrushBorder}" />
                        <TextBlock x:Name="ClockText" Margin="0,0,6,0" />
                    </StackPanel>
                </Grid>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
